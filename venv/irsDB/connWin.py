# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'connAddWin.ui'
#
# Created by: PyQt5 UI code generator 5.15.4
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

import peewee
from models import *
from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtWidgets import QTableWidgetItem as twi


class Ui_connAdd(object):
    def setupUi(self, connAdd):
        connAdd.setObjectName("connAdd")
        connAdd.resize(400, 300)
        self.verticalLayout = QtWidgets.QVBoxLayout(connAdd)
        self.verticalLayout.setObjectName("verticalLayout")
        self.listOfConn = QtWidgets.QTableWidget(connAdd)
        self.listOfConn.setObjectName("listOfConn")
        self.verticalLayout.addWidget(self.listOfConn)
        self.horizontalLayout = QtWidgets.QHBoxLayout()
        self.horizontalLayout.setObjectName("horizontalLayout")
        spacerItem = QtWidgets.QSpacerItem(40, 20, QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Minimum)
        self.horizontalLayout.addItem(spacerItem)
        self.addButton = QtWidgets.QPushButton(connAdd)
        self.addButton.setObjectName("Присвоить соединения")
        self.horizontalLayout.addWidget(self.addButton)
        self.verticalLayout.addLayout(self.horizontalLayout)

        self.retranslateUi(connAdd)
        QtCore.QMetaObject.connectSlotsByName(connAdd)

        self.listOfConn.setColumnCount(11)
        self.listOfConn.setHorizontalHeaderLabels(
            ["id", "Вид сварного соединения", "Толщина элементов (мм)", "Разделка кромок", "Размеры шва (мм)",
             "Марка/сечение проволоки (мм)", "Расход проволоки (см/мин)", "Газ", "Расход газа (л/мин)",
             "Программа сварки", "Рассчётное время"])
        connections = Connection.select()
        self.listOfConn.setRowCount(len(connections))
        for i in range(len(connections)):
            self.listOfConn.setItem(i, 0, twi(str(connections[i].id)))
            self.listOfConn.setItem(i, 1, twi(connections[i].ctype))
            self.listOfConn.setItem(i, 2, twi(connections[i].thicknessOfElement))
            self.listOfConn.setItem(i, 3, twi(connections[i].jointBevelling))
            self.listOfConn.setItem(i, 4, twi(connections[i].seamDimensions))
            self.listOfConn.setItem(i, 5,
                                     twi(connections[i].fillerWireMark + '/' + str(connections[i].fillerWireDiam)))
            self.listOfConn.setItem(i, 6, twi(str(connections[i].wireConsumption)))
            self.listOfConn.setItem(i, 7, twi(connections[i].shieldingGasType))
            self.listOfConn.setItem(i, 8, twi(str(connections[i].shieldingGasConsumption)))
            self.listOfConn.setItem(i, 9, twi(connections[i].programmName))
            self.listOfConn.setItem(i, 10, twi(str(connections[i].weldingTime)))
        self.listOfConn.resizeColumnsToContents()
        self.addButton.clicked.connect(lambda: self.add(connAdd.detId))

    def add(self,id):
        print("add", id)
        conId = int(self.listOfConn.item(self.listOfConn.currentRow(), 0).text())
        DetConn(
        connId = conId,
        detailId = id).save()

    def retranslateUi(self, connAdd):
        _translate = QtCore.QCoreApplication.translate
        connAdd.setWindowTitle(_translate("connAdd", "ConnAdd"))
        self.addButton.setText(_translate("connAdd", "Присвоить соединения"))


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    connAdd = QtWidgets.QWidget()
    ui = Ui_connAdd()
    ui.setupUi(connAdd)
    connAdd.show()
    sys.exit(app.exec_())
